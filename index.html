<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#0f3460"/>
  <meta name="description" content="Track fire department apparatus locations and status"/>
  <title>Apparatus Dashboard</title>
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/pocketbase@0.21.1/dist/pocketbase.umd.js"></script>
</head>
<body>
  <header class="page-header">
    <h1>Apparatus Dashboard</h1>
    <button class="help-btn" onclick="openHelpModal()" aria-label="Help" title="Help">?</button>
    <button class="theme-toggle-btn" onclick="toggleTheme()" aria-label="Toggle theme" title="Toggle theme">
      <img src="/icons/sun.svg" alt="Sun icon" class="theme-icon sun-icon">
      <img src="/icons/moon.svg" alt="Moon icon" class="theme-icon moon-icon">
    </button>
    <button class="admin-btn" onclick="openAdminModal()">Admin</button>
  </header>
  <div class="grid" id="stationGrid"></div>
<!-- Apparatus Edit Modal -->
  <div id="editModal">
    <div class="modal-content">
      <h3 id="editModalTitle" style="margin: 0 0 1rem; font-size: 1.25rem; color: var(--text-primary);">Edit Apparatus</h3>
      <div class="edit-fields">
        <label class="field">
          <span class="field-label">ID</span>
          <input type="text" id="editId" />
        </label>
        <label class="field">
          <span class="field-label">Apparatus Type</span>
          <select id="editType"></select>
        </label>
        <div style="display: flex; gap: 1rem; align-items: center;">
          <label class="field checkbox-field" style="margin-bottom: 0;">
            <input type="checkbox" id="editReserve" />
            <span class="checkbox-label">Reserve</span>
          </label>
          <label class="field checkbox-field" style="margin-bottom: 0;">
            <input type="checkbox" id="editOOS" />
            <span class="checkbox-label">OOS</span>
          </label>
        </div>
        <label class="field">
          <span class="field-label">Home Station</span>
          <select id="editHomeStation"></select>
        </label>
        <label class="field">
          <span class="field-label">Current Station</span>
          <select id="editStation"></select>
        </label>
        <label class="field">
          <span class="field-label">Notes</span>
          <textarea id="editNotes" rows="3"></textarea>
        </label>
      </div>
      <div class="modal-actions">
        <button onclick="saveApparatusEdit()">Save</button>
        <button class="secondary" onclick="closeEditModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Admin Modal with Tabs -->
  <div id="adminModal">
    <div class="modal-content">
      <div class="tabs">
        <button class="tab active" onclick="switchTab('apparatus')">Apparatus</button>
        <button class="tab" onclick="switchTab('stations')">Stations</button>
        <button class="tab" onclick="switchTab('data')">Data</button>
      </div>

      <div id="stations" class="tab-content active">
        <div class="tab-header">
          <h2>Stations</h2>
        </div>
        <div id="stationList"></div>
        <div id="stationAdder" class="row add-row hidden">
          <label class="field">
            <span class="field-label">Station Name</span>
            <input type="text" id="stationAdderName" placeholder="Station 9" />
          </label>
          <div class="modal-actions">
            <button id="stationAdderConfirm" type="button">Save Station</button>
            <button id="stationAdderCancel" class="secondary" type="button">Cancel</button>
          </div>
        </div>
        <div class="tab-footer">
          <button id="stationShowAdder" type="button">Add Station</button>
          <button class="secondary" type="button" onclick="closeAdminModal()">Exit</button>
        </div>
      </div>

      <div id="apparatus" class="tab-content active">
        <div class="tab-header">
          <h2>Apparatus</h2>
        </div>
        <div id="apparatusList"></div>
        <div id="apparatusAdder" class="row add-row hidden">
          <div class="row-body column">
            <label class="field">
              <span class="field-label">Number</span>
              <input type="text" id="apparatusAdderNumber" placeholder="4527" />
            </label>
            <label class="field">
              <span class="field-label">ID (optional)</span>
              <input type="text" id="apparatusAdderId" placeholder="E1" />
            </label>
            <label class="field">
              <span class="field-label">Type</span>
              <select id="apparatusAdderType"></select>
            </label>
            <div style="display: flex; gap: 1rem; align-items: center;">
              <label class="field checkbox-field" style="margin-bottom: 0;">
                <input type="checkbox" id="apparatusAdderReserve" />
                <span class="checkbox-label">Reserve</span>
              </label>
              <label class="field checkbox-field" style="margin-bottom: 0;">
                <input type="checkbox" id="apparatusAdderOOS" />
                <span class="checkbox-label">OOS</span>
              </label>
            </div>
            <label class="field">
              <span class="field-label">Notes (optional)</span>
              <input type="text" id="apparatusAdderNotes" placeholder="Ready reserve" />
            </label>
            <label class="field">
              <span class="field-label">Home Station</span>
              <select id="apparatusAdderHome"></select>
            </label>
            <label class="field">
              <span class="field-label">Current Station</span>
              <select id="apparatusAdderStation"></select>
            </label>
          </div>
          <div class="row-actions">
            <button id="apparatusAdderConfirm" type="button">Save Apparatus</button>
            <button id="apparatusAdderCancel" class="secondary" type="button">Cancel</button>
          </div>
        </div>
        <div class="tab-footer">
          <button id="apparatusShowAdder" type="button">Add Apparatus</button>
          <button class="secondary" type="button" onclick="closeAdminModal()">Exit</button>
        </div>
      </div>

      <div id="data" class="tab-content">
        <div class="tab-header">
          <h2>Data</h2>
          <p>Export or import station and apparatus data for backups or transfers.</p>
        </div>
        <div class="data-actions">
          <button id="backupButton" type="button">Export JSON</button>
          <label class="import-label">
            <input id="importInput" type="file" accept="application/json" />
            <span>Import JSON</span>
          </label>
        </div>
        <p class="data-note">Export creates a JSON file containing both stations and apparatus arrays. Import replaces existing data with the uploaded backup.</p>
      </div>
    </div>
  </div>
  <!-- Login Modal -->
  <div id="loginModal">
    <div class="modal-content login-modal-content">
      <h2>Fire Department Login</h2>
      <p class="login-description">Please login to access the dashboard</p>
      <div id="loginError" class="login-error hidden"></div>
      <div class="login-form">
        <label class="field">
          <span class="field-label">Username</span>
          <input type="text" id="loginUsername" placeholder="Enter username" />
        </label>
        <label class="field">
          <span class="field-label">Password</span>
          <input type="password" id="loginPassword" placeholder="Enter password" />
        </label>
        <button id="loginButton" type="button">Login</button>
      </div>
    </div>
  </div>
  <!-- Help Modal -->
  <div id="helpModal">
    <div class="modal-content help-modal-content">
      <h2>Help</h2>

      <div class="help-section">
        <h3>Apparatus Display</h3>
        <div class="help-examples">
          <div class="help-example">
            <div class="apparatus red">E1 4919</div>
            <p>Normal apparatus</p>
          </div>
          <div class="help-example">
            <div class="apparatus blue reserve">M3 4530</div>
            <p>Reserve</p>
          </div>
          <div class="help-example">
            <div class="apparatus green oos"><s>A2 4526</s> (OOS)</div>
            <p>Out-of-Service</p>
          </div>
          <div class="help-example">
            <div class="apparatus yellow ghost">AT102 4514</div>
            <p>Out of Home Station</p>
          </div>
        </div>
      </div>

      <div class="help-section">
        <h3>Reserve vs Out-of-Service</h3>
        <p><strong>Reserve:</strong> Reserve apparatus.</p>
        <p><strong>Out-of-Service (OOS):</strong> Apparatus temporarily OOS, typically when at a station and not the shop.</p>
      </div>

      <div class="help-section">
        <h3>Moving Apparatus</h3>
        <p><strong>Desktop:</strong> Click and drag apparatus between stations.</p>
        <p><strong>Mobile:</strong> Tap an apparatus to open the menu, then select the destination station.</p>
        <p><strong>Ghost:</strong> A "ghost" button will be left at a unit's "home" station, if assigned one.</p>
      </div>

      <div class="help-section">
        <h3>Editing Apparatus</h3>
        <p><strong>Desktop:</strong> Click an apparatus to edit its details.</p>
        <p><strong>Mobile/Tablet:</strong> Tap an apparatus and select "Edit" from the menu.</p>
        <p>
          <strong>Name:</strong>
          The ID is the in-service identifier (E1, AT102, etc.).
          It can be empty if that unit is in service on a different apparatus.
        </p>
      </div>

      <div class="modal-actions">
        <button onclick="closeHelpModal()">Close</button>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
</body>
</html>
